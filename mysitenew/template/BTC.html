  <!DCTYPE html>
  <html>

  <head>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
    <title>I come from template!!</title>
    <style>
    body {
      background-color: lightyellow;
    }

    em {
      color: LightSeaGreen;
    }
  </style>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.8.2/jquery.min.js" type="text/javascript"></script>
  <script src="http://127.0.0.1:4000/socket.io/socket.io.js"></script>
  <script>
    $(document).ready(function(){
      //  SetData();
        var socket = io.connect('http://127.0.0.1:4000');
        console.log(socket)
        socket.on('connect', function(){
          console.log("connect");
        //  SetData();
        });
        var options = 
        {
          year: "numeric", month: "short",
          day: "numeric", hour: "2-digit", minute: "2-digit"
        };

          socket.on('message', function(message) 
          {
            console.log('send message');
            //console.log(message);
            var megObjs = JSON.parse(message);
            var outputMeg=[]
            //var dic=[{"trips.cryptopiaBTCTable":[],"trips.bitfinexbtctable":[],"trips.binancebtctable":[],"trips.cexbtctable":[],"trips.bittrexbtctable":[]}];
            megObjs.map(megObj => {
              myDate=new Date(megObj.fields.created_at) //change date type
              megObj.fields.created_at= myDate.toLocaleTimeString("en-us", options);
              outputMeg.push(megObj.fields) //push all obj to list
            });
            console.log(megObjs[0].model)
            var dt = dynamicTable.config( megObjs[0].model, 
                ['bid', 'ask', 'last','created_at'], 
                ['bid', 'ask', 'last','time'], //set to null for field names 
                'There are no items to list...');
            dt.load(outputMeg);
            //console.log(outputMeg);
            //AddData();
          });
        });
    ///////////////////////dynamic table////////////////////////
      var dynamicTable = (function() {
        var _tableId, _table, 
        _fields, _headers, 
        _defaultText;
        function _buildRowColumns(names, item) {
          var row = '<tr>';
          var i=0;
          if (names && names.length > 0)
          {
            var c = item ?  '0': '#';
            row += '<td>' + c + '</td>';
            $.each(names, function(index, name) {
              var c = item ? item[name+''] : name;
              row += '<td>' + c + '</td>';
            });
          }
          row += '<tr>';
          return row;
        }
        
        /** Builds and sets the headers of the table. */
        function _setHeaders() {
            // if no headers specified, we will use the fields as headers.
            _headers = (_headers == null || _headers.length < 1) ? _fields : _headers; 
            var h = _buildRowColumns(_headers);
            if (_table.children('thead').length < 1) _table.prepend('<thead></thead>');
            _table.children('thead').html(h);
          }

          return {
            //* Configres the dynamic table. 
            config: function(tableId, fields, headers, defaultText) {
              _tableId = tableId;
              _table = $(document.getElementById(_tableId))//$('#' + tableId);
              _fields = fields || null;
              _headers = headers || null;
              _defaultText = defaultText || 'No items to list...';
              _setHeaders();
              return this;
            },
            /** Loads the specified data to the table body. */
            load: function(data, append) {
              var i=0;
                if (_table.length < 1) return; //not configured.
                _setHeaders();
                if (data && data.length > 0) {
                  var rows = '';
                  $.each(data, function(index, item) {
                    rows += _buildRowColumns(_fields, item);
                  });
                  var mthd = append ? 'append' : 'html';
                  _table.children('tbody')[mthd](rows);
                }
                return this;
              },
              /** Clears the table body. */
            };
          }());
     
/////////////////////////////////////////////////////////////////
</script>
</head>

<body>
  <div class="container">
    <div class="row">
      <pre>{{ans}}</pre>
      <form action="test1" method="get">
        <button name="subject" type="submit" value="Submit">确定</button>
      </form>
    </div>
    <!--~~~~~~~~~~~~~~~~~~~~~~~~~~Bittrex~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~-->
    <div class="row">
      <em>{{ current_time }}</em>
      <em>{{ change_time }}</em>
    </div>
    <div class="row">
      <div class="table-responsive">
        <table id="trips.bittrexbtctable" class="table table-bordered table-dark">
          <thead>
            <tr>
              <th style="width:10%">#Bittrex</th>
              <th style="width:20%">bid</th>
              <th style="width:20%">ask</th>
              <th style="width:20%">last</th>
              <th style="width:30%">time</th>
            </tr>
          </thead>
          <tbody>
            {% for Bittrex in BittrexBTCTable %}
            <tr>
              <td>{{forloop.counter}}</td>
              <td>{{Bittrex.bid}}</td>
              <td>{{Bittrex.ask}}</td>
              <td>{{Bittrex.last}}</td>
              <td>{{Bittrex.created_at}}</td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    </div>
    <!--~~~~~~~~~~~~~~~~~~~~~~~~~~Bittrex~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~-->

    <!--~~~~~~~~~~~~~~~~~~~~~~~~~~~~~Cex~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~-->
    <div class="row"> 
      <table id="trips.cexbtctable" class="table table-bordered table-dark">
        <thead>
          <tr>
            <th style="width:10%">#Cex</th>
            <th style="width:20%">bid</th>
            <th style="width:20%">ask</th>
            <th style="width:20%">last</th>
            <th style="width:30%">time</th>
          </tr>
        </thead>
        <tbody>
          {% for Cex in CexBTCTable %}
          <tr>
            <th scope="col">{{forloop.counter}}</th>
            <td>{{Cex.bid}}</td>
            <td>{{Cex.ask}}</td>
            <td>{{Cex.last}}</td>
            <td>{{Cex.created_at}}</td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
    <!--~~~~~~~~~~~~~~~~~~~~~~~~~~~~~Cex~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~-->

    <!--~~~~~~~~~~~~~~~~~~~~~~~~~~~Binance~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~-->
    <div class="row"> 
      <table id="trips.binancebtctable" class="table table-bordered table-dark">
        <thead>
          <tr>
            <th style="width:10%">#binance</th>
            <th style="width:20%">bid</th>
            <th style="width:20%">ask</th>
            <th style="width:20%">last</th>
            <th style="width:30%">time</th>
          </tr>
        </thead>
        <tbody>
          {% for Binance in BinanceBTCTable %}
          <tr>
            <th scope="col">{{forloop.counter}}</th>
            <td>{{Binance.bid}}</td>
            <td>{{Binance.ask}}</td>
            <td>{{Binance.last}}</td>
            <td>{{Binance.created_at}}</td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
    <!--~~~~~~~~~~~~~~~~~~~~~~~~~~~Binance~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~-->

    <!--~~~~~~~~~~~~~~~~~~~~~~~~~~~Bitfinex~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~-->
    <div class="row"> 
      <table id="trips.bitfinexbtctable" class="table table-bordered table-dark">
        <thead>
          <tr>
            <th style="width:10%">#Bitfinex</th>
            <th style="width:20%">bid</th>
            <th style="width:20%">ask</th>
            <th style="width:20%">last</th>
            <th style="width:30%">time</th>
          </tr>
        </thead>
        <tbody>
          {% for Bitfinex in BitfinexBTCTable %}
          <tr>
            <th scope="col">{{forloop.counter}}</th>
            <td>{{Bitfinex.bid}}</td>
            <td>{{Bitfinex.ask}}</td>
            <td>{{Bitfinex.last}}</td>
            <td>{{Bitfinex.created_at}}</td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
    <!--~~~~~~~~~~~~~~~~~~~~~~~~~~~Bitfinex~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~-->

    <!--~~~~~~~~~~~~~~~~~~~~~~~~~~~Cryptopia~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~-->
    <div class="row"> 
      <table id="trips.cryptopiabtctable"class="table table-bordered table-dark">
        <thead>
          <tr>
            <th style="width:10%">#Cryptopia</th>
            <th style="width:20%">bid</th>
            <th style="width:20%">ask</th>
            <th style="width:20%">last</th>
            <th style="width:30%">time</th>
          </tr>
        </thead>
        <tbody>
          {% for Cryptopia in CryptopiaBTCTable %}
          <tr>
            <th scope="col">{{forloop.counter}}</th>
            <td>{{Cryptopia.bid}}</td>
            <td>{{Cryptopia.ask}}</td>
            <td>{{Cryptopia.last}}</td>
            <td>{{Cryptopia.created_at}}</td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
    <!--~~~~~~~~~~~~~~~~~~~~~~~~~~~Cryptopia~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~-->
    <div class="row"> 
      <table class="table table-bordered table-dark">
        <thead>
          <tr>
            <th style="width:10%">#difference</th>
            <th style="width:20%">Bittrex</th>
            <th style="width:20%">Cex</th>
            <th style="width:20%">Binance</th>
            <th style="width:30%">Bitfinex</th>
            <th style="width:30%">Cryptopia</th>
          </tr>
        </thead>
        <tbody>
          {% for key, value in dif.items %}
          <tr>
            <th scope="col">{{key}}</th>
            <th>{{value.Bittrex}}</th>
            <td>{{value.Cex}}</td>
            <td>{{value.Binance}}</td>
            <td>{{value.Bitfinex}}</td>
            <td>{{value.Cryptopia}}</td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>    
  </div>
</body>

</html>